<!doctype html>
<html lang="ca">

<head>
    <meta charset="utf-8">
    <title>Apunts Joan Pardo per DigiTechFP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../../assets/css/portal.css">
    <link rel="stylesheet" href="../../../assets/css/base.css">
    <link rel="stylesheet" href="../../../assets/css/tema.css">
    <link rel="stylesheet" href="../../../assets/css/fonts.css">
</head>

<body class="portal">
    <header class="header-row">
        <div class="topbar">
            <p class="subtitle"><a href="https://jpardo20.github.io/apunts-jpardo20/">← Tornar a l'inici</a></p>
            <h1 id="topbar-title">Apunts 0223 Aplicacions ofimàtiques</h1>
            <img src="../../../assets/img/Logo_DIGIQTECH_343x99.png" alt="DigiTech" class="logo" height="70"
                width="auto">
        </div>
    </header>

    <!-- Controls -->
    <div class="toolbar">
        <input id="search" type="search" placeholder="Cerca per títol o descripció…">
        <select id="sort" class="sort-select" aria-label="Ordena">
            <option value="title-az">Títol A → Z</option>
            <option value="title-za">Títol Z → A</option>
            <option value="date-new">Data (recent primer)</option>
            <option value="date-old">Data (antic primer)</option>
        </select>
    </div>



    <main>
        <section id="grid" class="grid" aria-live="polite"></section>
    </main>

    <footer class="site-footer">© 2025 · Apunts Joan Pardo per DigiTechFP</footer>

    <script>
        const el = (sel) => document.querySelector(sel);
        const grid = el('#grid');
        const searchInput = el('#search');
        const sortSelect = el('#sort');
        let items = [];

        function cardTemplate(item) {
            const status = (item.status || 'active').toLowerCase();
            const desc = item.description ? `<p>${item.description}</p>` : '';
            const title = item.title || 'Presentació';
            const href = `./presentador.html?src=${encodeURIComponent(item.src || '')}${item.theme ? `&theme=${encodeURIComponent(item.theme)}` : ''}${item.title ? `&title=${encodeURIComponent(item.title)}` : ''}`;
            const articleClass = `card${status === 'inactive' ? ' card--inactive' : ''}`;
            const badge = status === 'inactive' ? `<span class="badge badge--soon">Properament</span>` : '';
            const button = status === 'inactive'
                ? `<span class="button disabled" role="link" aria-disabled="true" title="Properament">No disponible</span>`
                : `<a class="button primary" href="${href}">Obrir presentació</a>`;
            return `<article class="${articleClass}">
                ${badge}
                <h2>${title}</h2>
                ${desc}
                <p>${button}</p>
              </article>`;
        }

        function render(list) {
            grid.innerHTML = list.map(cardTemplate).join('\n');
        }

        function applyFilters() {
            const q = (searchInput?.value || '').toLowerCase().trim();
            const mode = sortSelect?.value || 'title-az';
            let list = (items || []).filter(it => {
                const status = (it.status || 'active').toLowerCase();
                if (status === 'hidden') return false;
                const t = (it.title || '').toLowerCase();
                const d = (it.description || '').toLowerCase();
                return !q || t.includes(q) || d.includes(q);
            });
            list.sort((a, b) => {
                if (mode === 'title-az') return (a.title || '').localeCompare(b.title || '');
                if (mode === 'title-za') return (b.title || '').localeCompare(a.title || '');
                if (mode === 'date-new' || mode === 'date-old') {
                    const ad = new Date(a.date || 0).getTime() || 0;
                    const bd = new Date(b.date || 0).getTime() || 0;
                    return mode === 'date-new' ? bd - ad : ad - bd;
                }
                return (a.order ?? 9999) - (b.order ?? 9999);
            });
            render(list);
        }

        searchInput?.addEventListener('input', applyFilters);
        sortSelect?.addEventListener('change', applyFilters);

        fetch('presentacions.json')
            .then(r => r.json())
            .then(data => { items = data.presentations || []; applyFilters(); })
            .catch(err => {
                grid.innerHTML = '<p>No s\'ha pogut carregar el llistat de presentacions.</p>';
                console.error(err);
            });
    </script>
</body>

</html>