# ALTER TABLE, c√≤pies de seguretat i duplicats
## 0484 ‚Äì Bases de dades (1r DAM)

---

## Abans de fer res: c√≤pia de seguretat

Abans de modificar una base de dades:

- **Sempre** fem una c√≤pia de seguretat
- Encara que ‚Äúnom√©s‚Äù siguin proves
- Encara que ‚Äúnom√©s‚Äù siguin INSERTs

Note:
Temps: 2 min  
Temps acumulat: 2 min  

Aix√≤ √©s un h√†bit professional fonamental.  
No comencem mai tocant dades directament.  
Primer ens assegurem que podem tornar enrere si passa qualsevol cosa.

---

## C√≤pia de seguretat (idea general)

Una c√≤pia de seguretat ens permet:

- Tornar a un estat anterior
- Desfer errors humans
- Provar coses **sense por**

> No cal saber-la fer encara, nom√©s saber que **existeix**

Note:
Temps: 2 min  
Temps acumulat: 4 min  

No entris en detalls t√®cnics encara.  
L‚Äôobjectiu √©s entendre **per qu√®** es fa, no **com**.  

---

## Sintaxi b√†sica de c√≤pia de seguretat

Exemple de c√≤pia completa d‚Äôuna base de dades:

```bash
mysqldump -u root -p videojoc_online > backup_videojoc.sql
```

- Es crea un fitxer `.sql`
- Cont√© l‚Äôestructura i les dades
- Representa l‚Äôestat actual de la base de dades

Note:
Temps: 2 min  
Temps acumulat: 6 min  

No expliquis opcions ni par√†metres.  
Remarca que √©s un exemple **conceptual**.  
L‚Äôimportant √©s entendre que tenim un fitxer amb ‚Äúuna foto‚Äù de la BD.

---

## Fem un canvi ‚Äúdolent‚Äù a prop√≤sit

Executem un INSERT incorrecte o duplicat

```sql
INSERT INTO jugador (nom_usuari, email, data_registre)
VALUES ('alphaWolf', 'alpha@game.com', '2026-01-18');
```

El nombre de registres **canvia**

Note:
Temps: 2 min  
Temps acumulat: 8 min  

Mostra un `COUNT(*)` abans i despr√©s.  
Que vegin clarament que **una sola comanda** pot alterar l‚Äôestat de la BD.  
Aqu√≠ encara no arreglem res.

---

## Tornem enrere amb la c√≤pia

Restaurem la c√≤pia de seguretat

```bash
mysql -u root -p videojoc_online < backup_videojoc.sql
```

- El registre ‚Äúdesapareix‚Äù
- Tornem exactament a l‚Äôestat anterior

> No l‚Äôhem esborrat: **hem restaurat**

Note:
Temps: 2 min  
Temps acumulat: 10 min  

Moment clau.  
Insisteix que no estem ‚Äúdesfent amb SQL‚Äù,  
sin√≥ **tornant en el temps** a un estat anterior.

---

## Context inicial realista

Tots partim d‚Äôuna base de dades:

- Amb dades pr√®vies
- D‚Äôactivitats anteriors
- **No buida**

Note:
Temps: 2 min  
Temps acumulat: 12 min  

Aix√≤ √©s molt important:  
no estem treballant en una BD neta de laboratori.  
√âs una situaci√≥ **real**.

---

## Abans de continuar: noms de les taules

Actualment les taules es diuen:

- jugador
- personatge
- partida
- participa

Les volem en **maj√∫scules i plural**

Note:
Temps: 2 min  
Temps acumulat: 14 min  

No √©s nom√©s est√®tica.  
√âs coher√®ncia, llegibilitat i convenci√≥ professional.

---

## Canviar el nom d‚Äôuna taula: alerta

No totes les maneres s√≥n igual de segures

- Algunes **respecten les relacions**
- Altres **trenquen les claus foranes**

Note:
Temps: 2 min  
Temps acumulat: 16 min  

Aqu√≠ introdueix el concepte de depend√®ncies.  
Les taules estan relacionades entre elles.

---

## Manera correcta (segura)

```sql
RENAME TABLE jugador TO JUGADORS;
```

o b√©:

```sql
ALTER TABLE jugador RENAME TO JUGADORS;
```

‚úî Mant√© dades  
‚úî Mant√© claus foranes  

Note:
Temps: 3 min  
Temps acumulat: 19 min  

Frase clau:  
Les claus foranes **no s√≥n text**, s√≥n objectes del sistema.  
MySQL sap actualitzar-les autom√†ticament.

---

## Manera incorrecta (NO fer-ho)

```sql
CREATE TABLE JUGADORS (...);
INSERT INTO JUGADORS SELECT * FROM jugador;
DROP TABLE jugador;
```

‚ùå Relacions trencades  
‚ùå Inconsist√®ncia  

Note:
Temps: 3 min  
Temps acumulat: 22 min  

Aix√≤ √©s el que molta gent fa malament.  
Aqu√≠ la base de dades **no ens pot protegir**.  
No tot el que ‚Äúfunciona‚Äù √©s correcte.

---

## SEGONA c√≤pia de seguretat

Despr√©s del canvi estructural:

- Taules ja amb noms definitius
- Relacions correctes
- Estat **estable**

üëâ Fem una **nova c√≤pia de seguretat**

```bash
mysqldump videojoc_online > backup_videojoc_estructura.sql
```

Note:
Temps: 2 min  
Temps acumulat: 24 min  

Explica que ara tenim un **nou punt segur**.  
Aquest √©s el punt de partida per treballar amb dades.

---

## Dataset com√∫ de la classe

Tots tenim **el mateix script** d‚Äôinserci√≥:

- Dades de tots els companys
- Dades extra
- Un sol INSERT per taula

Note:
Temps: 2 min  
Temps acumulat: 26 min  

Mostra nom√©s un fragment.  
El mateix fitxer per a tothom.

---

## Qu√® passa si l‚Äôexecutem?

Com que ja hi havia dades:

- Primera execuci√≥ ‚Üí ‚ùå **duplicats**
- Segona execuci√≥ ‚Üí ‚ùå **m√©s duplicats**

Note:
Temps: 3 min  
Temps acumulat: 29 min  

El problema apareix **ja a la primera execuci√≥**.  
No dep√®n de repetir-lo.

---

## Mala soluci√≥ (expressament)

‚ÄúAneu amb compte de no executar-lo m√©s d‚Äôun cop‚Äù

‚ùå No fiable  
‚ùå No professional  
‚ùå No escalable  

Note:
Temps: 2 min  
Temps acumulat: 31 min  

Una base de dades no pot confiar en l‚Äôusuari.

---

## La pregunta correcta

‚ùì Com pot la base de dades **impedir sola** els duplicats?

Note:
Temps: 2 min  
Temps acumulat: 33 min  

Primer el concepte, despr√©s el SQL.

---

## Dir-li a la BD qu√® √©s √∫nic

Exemples:

- nom_usuari no es pot repetir
- email no es pot repetir
- una partida √©s √∫nica per data + durada

Note:
Temps: 2 min  
Temps acumulat: 35 min  

Aix√≤ √©s disseny.

---

## ALTER TABLE + UNIQUE

```sql
ALTER TABLE JUGADORS
ADD CONSTRAINT uq_jugadors_nom UNIQUE (nom_usuari);
```

La BD **ara sap** qu√® √©s un duplicat

Note:
Temps: 3 min  
Temps acumulat: 38 min  

La base de dades passa a protegir les dades.

---

## Tornem a executar el mateix script

- No falla
- No duplica
- El podem executar moltes vegades

Note:
Temps: 2 min  
Temps acumulat: 40 min  

Moment ‚Äúwow‚Äù.

---

## Comprovaci√≥ objectiva

```sql
SELECT COUNT(*) FROM JUGADORS;
```

Tots hem d‚Äôobtenir **el mateix valor**

Note:
Temps: 2 min  
Temps acumulat: 42 min  

El comptador no menteix.

---

## I si vull desfer canvis m√©s fins?

Existeixen mecanismes com:

- **ROLLBACK**
- **Transaccions**

> Ho veurem m√©s endavant

Note:
Temps: 2 min  
Temps acumulat: 44 min  

Nom√©s plantar la llavor.

---

## Missatge final

> Una base de dades ben dissenyada  
> **no confia en l‚Äôusuari**  
>
> **es protegeix sola**

Note:
Temps: 2 min  
Temps acumulat: 46 min  

Aquesta √©s la idea clau de la sessi√≥.
